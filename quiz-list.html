<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø§Ù„Ù…Ø¬Ø±Ø© | Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙƒÙˆÙŠØ²Ø§Øª</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #7b5cff; --accent: #5eead4; --bg: #050507; --glass: rgba(255,255,255,0.08); }
        body { background: var(--bg); color: white; font-family: 'Cairo'; padding: 40px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
        .quiz-card { background: var(--glass); padding: 25px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.1); text-align: center; transition: 0.3s; }
        .quiz-card:hover { transform: translateY(-5px); border-color: var(--primary); }
        .btn { background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer; text-decoration: none; display: inline-block; margin-top: 15px; }
        .disabled { background: #333; cursor: not-allowed; opacity: 0.5; }
        .status { font-size: 0.8rem; margin-top: 10px; display: block; }
    </style>
</head>
<body>
    <h1>ğŸš€ ÙƒÙˆÙŠØ²Ø§Øª Ø§Ù„Ù…Ø¬Ø±Ø© Ø§Ù„Ù…ØªØ§Ø­Ø©</h1>
    <div class="grid" id="quizGrid"></div>

    <script>
        // Ù†ÙØ±Ø¶ Ø¥Ù†Ù†Ø§ Ø¹Ø§Ø±ÙÙŠÙ† Ø§Ù„Ù€ ID Ø¨ØªØ§Ø¹ Ø§Ù„Ø·Ø§Ù„Ø¨ (Ù…Ù…ÙƒÙ† Ù†Ø§Ø®Ø¯Ù‡ Ù…Ù† Ø§Ù„Ù€ URL)
        const memberId = new URLSearchParams(window.location.search).get('mid') || '001';

async function loadQuizzes() {
    try {
        // 1. Ù†Ø¬ÙŠØ¨ Ù„Ø³ØªØ© Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„ÙƒÙˆÙŠØ²Ø§Øª Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±
        const res = await fetch('/list-quizzes');
        const titles = await res.json();
        const grid = document.getElementById('quizGrid');
        
        // Ù…Ø³Ø­ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù‚Ø¯ÙŠÙ… Ù„Ùˆ Ù…ÙˆØ¬ÙˆØ¯
        grid.innerHTML = '';

        if (titles.length === 0) {
            grid.innerHTML = '<p>Ù…ÙÙŠØ´ ÙƒÙˆÙŠØ²Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹ ÙÙŠ Ø§Ù„Ù…Ø¬Ø±Ø©.. Ø¶ÙŠÙ ÙˆØ§Ø­Ø¯ Ù…Ù† Ø§Ù„Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯!</p>';
            return;
        }

        // Ù†Ø¬ÙŠØ¨ Ø§Ù„Ù€ ID Ø¨ØªØ§Ø¹ Ø§Ù„Ø·Ø§Ù„Ø¨ Ù…Ù† Ø§Ù„Ù„ÙŠÙ†Ùƒ (Ø£Ùˆ Ù†ÙØªØ±Ø¶ 001 Ù„Ùˆ Ù…Ø´ Ù…ÙˆØ¬ÙˆØ¯)
        const urlParams = new URLSearchParams(window.location.search);
        const memberId = urlParams.get('mid') || '001';

        for (const title of titles) {
            // 2. Ù†Ø´ÙŠÙƒ Ù‡Ù„ Ø§Ù„Ø·Ø§Ù„Ø¨ Ø­Ù„Ù‡ Ù‚Ø¨Ù„ ÙƒØ¯Ù‡ØŸ
            const checkRes = await fetch(`/check-attempt/${memberId}/${title}`);
            const { attempted } = await checkRes.json();

            const card = document.createElement('div');
            card.className = 'quiz-card';
            card.innerHTML = `
                <h3>${title}</h3>
                <span class="status">${attempted ? 'âœ… ØªÙ… Ø§Ù„Ø­Ù„ Ø³Ø§Ø¨Ù‚Ø§Ù‹' : 'ğŸ•’ Ù…ØªØ§Ø­ Ø§Ù„Ø¢Ù†'}</span>
                ${attempted 
                    ? `<button class="btn disabled" disabled>Ù…ØºÙ„Ù‚</button>` 
                    : `<a href="quiz.html?title=${encodeURIComponent(title)}&mid=${memberId}" class="btn">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù†</a>`}
            `;
            grid.appendChild(card);
        }
    } catch (error) {
        console.error("Error loading quizzes:", error);
        document.getElementById('quizGrid').innerHTML = '<p>Ø­ØµÙ„Øª Ù…Ø´ÙƒÙ„Ø© ÙˆØ£Ø­Ù†Ø§ Ø¨Ù†Ø¬ÙŠØ¨ Ø§Ù„ÙƒÙˆÙŠØ²Ø§Øª.. Ø§ØªØ£ÙƒØ¯ Ø¥Ù† Ø§Ù„Ø³ÙŠØ±ÙØ± Ø´ØºØ§Ù„.</p>';
    }
}

// ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¯Ø§Ù„Ø© ÙÙˆØ± ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
window.onload = loadQuizzes;
    </script>
</body>
</html>