<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Tech Verse Quiz | Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø¬Ø±Ø©</title>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">

<style>
:root{
    --bg:#050507;
    --primary:#7b5cff;
    --accent:#5eead4;
    --danger:#ff6b6b;
    --glass:rgba(255,255,255,.08);
    --text:#e5e7eb;
}

*{box-sizing:border-box}

body{
    margin:0;
    min-height:100vh;
    font-family:'Cairo',sans-serif;
    background:
        radial-gradient(circle at top right,#24145a,transparent),
        radial-gradient(circle at bottom left,#0f766e,transparent),
        var(--bg);
    color:var(--text);
    display:flex;
    justify-content:center;
    align-items:center;
    padding:20px;
}

.quiz-card{
    width:100%;
    max-width:520px;
    background:var(--glass);
    backdrop-filter:blur(25px);
    border-radius:26px;
    padding:28px;
    border:1px solid rgba(255,255,255,.12);
    box-shadow:0 0 45px rgba(123,92,255,.35);
    animation:fadeUp .6s ease;
}

.hidden{display:none!important}

h1,h2,h3{margin-top:0}

input[type="text"],
input[type="file"]{
    width:100%;
    padding:14px;
    margin:10px 0;
    border-radius:14px;
    background:#0f0f14;
    border:1px solid #2a2a35;
    color:white;
    font-family:'Cairo';
}

label{font-size:.85rem;color:#9ca3af}

.start-btn{
    width:100%;
    padding:15px;
    margin-top:15px;
    border:none;
    border-radius:16px;
    background:linear-gradient(135deg,var(--primary),#9b7bff);
    color:white;
    font-size:1rem;
    font-weight:700;
    cursor:pointer;
    transition:.3s;
}

.start-btn:hover{
    transform:translateY(-2px);
    box-shadow:0 15px 40px rgba(123,92,255,.45);
}

#quizHeader{
    margin-bottom:10px;
}

#counter{
    font-size:.8rem;
    color:#9ca3af;
}

.option{
    padding:16px;
    margin:12px 0;
    border-radius:16px;
    background:rgba(255,255,255,.05);
    border:1px solid transparent;
    cursor:pointer;
    transition:.25s;
}

.option:hover{
    background:rgba(123,92,255,.15);
    border-color:var(--primary);
}

.option.correct{
    background:rgba(94,234,212,.15);
    border-color:var(--accent);
    color:var(--accent);
}

.option.wrong{
    background:rgba(255,107,107,.15);
    border-color:var(--danger);
    color:var(--danger);
}

#nextBtn{
    opacity:.5;
    pointer-events:none;
}

/* Modal */
.modal{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.7);
    display:flex;
    justify-content:center;
    align-items:center;
    z-index:99;
}

.modal-box{
    background:var(--glass);
    backdrop-filter:blur(25px);
    padding:26px;
    border-radius:22px;
    text-align:center;
    border:1px solid rgba(255,255,255,.15);
    max-width:340px;
}

.modal-box p{
    font-size:.9rem;
    color:#cbd5f5;
}

.result-line{
    font-size:1.1rem;
    margin:8px 0;
}

@keyframes fadeUp{
    from{opacity:0;transform:translateY(20px)}
    to{opacity:1;transform:none}
}
</style>
</head>
<body>

<!-- LOGIN -->
<div class="quiz-card" id="loginBox">
    <h2 style="text-align:center">ğŸš€ Ø¯Ø®ÙˆÙ„ ÙƒÙˆÙŠØ² Tech Verse</h2>
    <p style="font-size:.9rem;color:#9ca3af;text-align:center">
        Ø§Ù„Ø§Ø³Ù… + ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ù…Ø·Ù„ÙˆØ¨Ø©
    </p>
    <input type="text" id="userName" placeholder="Ø§Ø³Ù…Ùƒ Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ">
    <label>ØµÙˆØ±Ø© Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¹Ø¶ÙˆÙŠØ©</label>
    <input type="file" id="userCard" accept="image/*">
    <button class="start-btn" onclick="startQuiz()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>
</div>

<!-- QUIZ -->
<div class="quiz-card hidden" id="quizBox">
    <div id="quizHeader">
        <div id="quizTitle" style="font-weight:900;color:var(--primary)"></div>
        <div id="counter"></div>
    </div>

    <div id="questionText" style="font-size:1.2rem;margin:20px 0"></div>
    <div id="optionsBox"></div>

    <button id="nextBtn" class="start-btn"></button>
</div>

<!-- RESULT -->
<div class="quiz-card hidden" id="resultBox" style="text-align:center">
    <h1>ğŸ‰ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</h1>
    <div id="finalScore" style="margin:20px 0"></div>
    <p id="tgStatus">Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†ØªÙŠØ¬Ø©...</p>
    <a href="quiz-list.html" style="color:var(--primary)">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ÙƒÙˆÙŠØ²Ø§Øª</a>
</div>

<script>
const TG_TOKEN="YOUR_BOT_TOKEN";
const TG_CHAT_ID="YOUR_CHAT_ID";

let quiz=null,idx=0,score=0,wrong=0,locked=false;
let startTime=null;
let userData={name:"",cardFile:null};

const title=new URLSearchParams(location.search).get("title");
fetch(`/get-quiz/${title}`).then(r=>r.json()).then(d=>quiz=d);

function startQuiz(){
    if(!userName.value||!userCard.files[0])
        return alert("ÙƒÙ…Ù‘Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙŠØ§ Ø¨Ø·Ù„ â­");

    userData={name:userName.value,cardFile:userCard.files[0]};
    startTime=Date.now();
    loginBox.classList.add("hidden");
    quizBox.classList.remove("hidden");
    loadQuestion();
}

function loadQuestion(){
    locked=false;
    nextBtn.style.opacity=".5";
    nextBtn.style.pointerEvents="none";

    const q=quiz.questions[idx];
    quizTitle.innerText=quiz.title;
    questionText.innerText=q.question;
    counter.innerText=`Ø³Ø¤Ø§Ù„ ${idx+1} Ù…Ù† ${quiz.questions.length}`;

    optionsBox.innerHTML="";
    q.options.forEach(opt=>{
        const d=document.createElement("div");
        d.className="option";
        d.innerText=opt;
        d.onclick=()=>selectOption(d,opt,q.correct);
        optionsBox.appendChild(d);
    });

    nextBtn.innerText=idx===quiz.questions.length-1
        ?"ğŸ“¤ ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª"
        :"Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ";
}

function selectOption(el,sel,cor){
    if(locked)return;
    locked=true;

    document.querySelectorAll('.option').forEach(o=>{
        if(o.innerText.trim()===cor.trim()) o.classList.add("correct");
    });

    if(sel.trim()===cor.trim()) score++;
    else{ el.classList.add("wrong"); wrong++; }

    nextBtn.style.opacity="1";
    nextBtn.style.pointerEvents="auto";
}

nextBtn.onclick=()=>{
    if(idx===quiz.questions.length-1) confirmSubmit();
    else{ idx++; loadQuestion(); }
};

function confirmSubmit(){
    const m=document.createElement("div");
    m.className="modal";
    m.innerHTML=`
        <div class="modal-box">
            <h3>ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªØ³Ù„ÙŠÙ…</h3>
            <p>Ù…Ø´ Ù‡ÙŠÙ†ÙØ¹ ØªØ¹Ø¯Ù‘Ù„ Ø¨Ø¹Ø¯ ÙƒØ¯Ù‡</p>
            <button class="start-btn" onclick="finishQuiz()">ØªØ³Ù„ÙŠÙ…</button>
            <button class="start-btn" style="background:#333;margin-top:10px"
                onclick="this.closest('.modal').remove()">Ø¥Ù„ØºØ§Ø¡</button>
        </div>`;
    document.body.appendChild(m);
}

function finishQuiz(){
    document.querySelector('.modal')?.remove();
    quizBox.classList.add("hidden");
    resultBox.classList.remove("hidden");

    const time=Math.floor((Date.now()-startTime)/1000);
    finalScore.innerHTML=`
        <div class="result-line">âœ”ï¸ Ø¥Ø¬Ø§Ø¨Ø§Øª ØµØ­ÙŠØ­Ø©: <b>${score}</b></div>
        <div class="result-line">âŒ Ø¥Ø¬Ø§Ø¨Ø§Øª ØºÙ„Ø·: <b>${wrong}</b></div>
        <div class="result-line">â±ï¸ Ø§Ù„ÙˆÙ‚Øª: <b>${time} Ø«Ø§Ù†ÙŠØ©</b></div>
    `;

    sendToTelegram(time);
}

async function sendToTelegram(time){
    const msg=`ğŸš€ Ù†ØªÙŠØ¬Ø© ÙƒÙˆÙŠØ²
ğŸ‘¤ ${userData.name}
ğŸ“š ${quiz.title}
âœ”ï¸ ØµØ­: ${score}
âŒ ØºÙ„Ø·: ${wrong}
â±ï¸ ${time}s`;

    const fd=new FormData();
    fd.append("chat_id",TG_CHAT_ID);
    fd.append("photo",userData.cardFile);
    fd.append("caption",msg);

    try{
        await fetch(`https://api.telegram.org/bot${TG_TOKEN}/sendPhoto`,{
            method:"POST",body:fd
        });
        tgStatus.innerText="âœ… Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§ØªØ¨Ø¹ØªØª Ø¨Ù†Ø¬Ø§Ø­";
    }catch{
        tgStatus.innerText="âŒ ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„";
    }
}
</script>
</body>
</html>
